<!DOCTYPE html>
<html>
<head>
  <title>Bazaar Flipper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    
    body {
      font-family: 'Courier New', monospace;
      text-align: center;
      font-size: 20px;
      background-image: radial-gradient(#00ff38, #007f1c);
      background-size: 100% 100%;
      background-repeat: no-repeat;
    }
    
    h1 {
      font-size: 70px;
      font-family: 'Courier New', monospace;
      font-weight: bold; 
    }
    
    .tablink {
      border-radius: 50px;
      font-family: 'Ika Compact VAR', fantasy;
      font-size: 20px;
      border: none;
      padding: 14px 16px;
      color: black;
      width: calc(20% - 10px); /* 4 buttons - 20px for margins */
      margin: 5px;
      background-image: linear-gradient(45deg, #3a85ea, #A44EFF);
    }
    
    .tablink:hover {
      background-image: linear-gradient(#1f0247, #7411ff);
    }

    .tabcontent {
      color: black;
      display: none;
      padding: 100px 20px;
      height: 100%;
    }

    .tabcontent p {
      text-align: left;
    }
    
    .column {
      float: left;
      width: 33.33%;
    }
    
    .row:after {
      content: "";
      display: table;
      clear: both;
    }

    .cursor {
      width: 2px;
      height: 43px;
      background: #EAEAEA;
      display: inline-block;
      margin-left: 2px;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }
  </style>
</head>
<body>
  <h1>Best tracker for <span id="typing-text"></span></h1>

  <button class="tablink" id="defaultOpen" onclick="openTab('Price Drops')">Price Drops</button>
  <button class="tablink" onclick="openTab('Price Rises')">Price Rises</button>
  <button class="tablink" onclick="openTab('Flipping')">Flipping</button>
  <button class="tablink" onclick="openTab('More')">More</button>

  <div id="Price Drops" class="tabcontent">
    <p id="priceDrops"></p>
  </div>

  <div id="Price Rises" class="tabcontent">
    <p id="priceRises"></p>
  </div>

  <div id="New Flips" class="tabcontent">
    <p id="hotNewFlips"></p>
  </div>

  <div id="Best Flips" class="tabcontent">
      <p id="flips"></p>
  </div>
  <script>
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    const strings = ["Price Drops", "Price Rises", "Flipping", "More"];
    const typingDelay = 200;
    const erasingDelay = 100;
    const newTextDelay = 2000; // Delay between current and next text
    let textArrayIndex = 0;
    let charIndex = 0;

    function type() {
      if (charIndex < strings[textArrayIndex].length) {
        if(!cursor.classList.contains("typing")) cursor.classList.add("typing");
        document.getElementById("typing-text").textContent += strings[textArrayIndex].charAt(charIndex);
        charIndex++;
        setTimeout(type, typingDelay);
      } 
      else {
        cursor.classList.remove("typing");
        setTimeout(erase, newTextDelay);
      }
    }

    function erase() {
      if (charIndex > 0) {
        if(!cursor.classList.contains("typing")) cursor.classList.add("typing");
        document.getElementById("typing-text").textContent = strings[textArrayIndex].substring(0, charIndex-1);
        charIndex--;
        setTimeout(erase, erasingDelay);
      } 
      else {
        cursor.classList.remove("typing");
        textArrayIndex++;
        if(textArrayIndex>=strings.length) textArrayIndex=0;
        setTimeout(type, typingDelay + 1100);
      }
    }

    document.addEventListener("DOMContentLoaded", function() { 
      if(strings.length) setTimeout(type, newTextDelay + 250);
    });

    function openTab(tabName) {
      let i, x, tablinks;
      x = document.getElementsByClassName("tabcontent");
      for (i = 0; i < x.length; i++) {
        x[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablink");
      for (i = 0; i < x.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" w3-red", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " w3-red";
    }

    document.getElementById("defaultOpen").click();
  </script>
   <script>
    const apiKey = '6a8c4882-3ad8-4136-a81d-51ecb1244f7a'; // Replace with your API key
    const priceDropThreshold = 0.2;
    const priceRiseThreshold = 0.2;
    const marginChangeThreshold = 0.2;

    let oldPricesSell = {};
    let oldPricesBuy = {};
    let priceDropList = [];

    async function getBazaarData(apiKey) {
      const base_url = 'https://api.hypixel.net';
      const endpoint = '/skyblock/bazaar';
      let response = await fetch(`${base_url}${endpoint}?key=${apiKey}`);
      let data = await response.json();
      return data;
    }

    function updateDisplay(id, text) {
      const element = document.getElementById(id);
      element.innerHTML = ""; // clear previous text
      element.innerHTML += text + "<br>";
    }

    async function monitorBazaar() {
      const bazaarData = await getBazaarData(apiKey);
      if (bazaarData === null) {
        return;
      }

      for (let product_id in bazaarData['products']) {
        const productData = bazaarData['products'][product_id];
        if (!productData['sell_summary'] || !productData['buy_summary']) {
            continue;
        }

        const sellPrice = productData['sell_summary'][0]['pricePerUnit'];
        const buyPrice = productData['buy_summary'][0]['pricePerUnit'];

        let oldPriceSell = oldPricesSell[product_id];
        let oldPriceBuy = oldPricesBuy[product_id];

        if (oldPriceSell && sellPrice < oldPriceSell * (1 - priceDropThreshold)) {
          const percent = Math.round(100 * (sellPrice / oldPriceSell));
          updateDisplay("priceDrops", `The sell price of ${product_id} has dropped significantly with a sell and buy price of ${sellPrice} and ${buyPrice}. The price decreased by ${percent}%.`);
        }
        
        if (oldPriceBuy && buyPrice > oldPriceBuy * (1 + priceRiseThreshold)) {
          const percent = Math.round(100 * (buyPrice / oldPriceBuy));
          updateDisplay("priceRises", `The buy price of ${product_id} has increased significantly with a sell and buy price of ${sellPrice} and ${buyPrice}. The price increased by ${percent}%.`);
        }
        
        if (oldPriceSell && oldPriceBuy && Math.abs(sellPrice - buyPrice) > oldPriceSell * marginChangeThreshold) {
          const percent = Math.round(100 * Math.abs(sellPrice - buyPrice) / oldPriceSell);
          updateDisplay("hotNewFlips", `The difference between the sell and buy prices of ${product_id} has changed significantly with a sell and buy price of ${sellPrice} and ${buyPrice}. The margin changed by ${percent}%.`);
        }

        oldPricesSell[product_id] = sellPrice;
        oldPricesBuy[product_id] = buyPrice;
      }
    }

    setInterval(monitorBazaar, 100);
  </script>

  <script>
    function openTab(tabName) {
      var i, x, tablinks;
      x = document.getElementsByClassName("tabcontent");
      for (i = 0; i < x.length; i++) {
        x[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablink");
      for (i = 0; i < x.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" w3-red", "");
      }
      document.getElementById(tabName).style.display = "block";
    }

    document.getElementById("defaultOpen").click();
  </script>
</body>
</html>
